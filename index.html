<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<style>
p {
    text-align: center;
    font-size: 1.3em;
}

#title {
    text-align: center;
    font-size: 2em;
    padding: 0px;
}

#sub {
    text-align: center;
    font-size: 1em;
    margin-top: -30px;
}

.special {
  display: inline-block;
  cursor: pointer;
  font-size: .7em;
  padding: 5px;
  margin-bottom: 10px;
  text-align: center;
  border: 1px solid #888;
  background-color: #ddd;
  transition: all ease-in-out 0.2s;
}
.special:hover {
  border: 1px solid #0078D7;
  background-color: #e5f1fb;
}

.button {
  display: inline-block;
  padding: 15px 25px;
  font-size: 24px;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  border: 3px solid black;
  color: #000000;
  background-color: #FFFFFF;
  border-radius: 15px;
  box-shadow: 0 8px #999;
  margin: 20px;
}

.button:hover {background-color: #3c8c3c}

.button:active {
  background-color: #3e8e41;
  box-shadow: 0 4px #666;
  transform: translateY(4px);
}

#btenergy {
    background-color: #FFFFFF;
}

#btenergy:hover {
    background-color: #bebe00;
}

#btenergy:active {
    background-color: #bebe00;
}

table {
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
  font-size: 1.3em;
}

table, td, th {
  border: 1px solid black;
  padding: 15px;
  text-align: center;
  font-weight: normal;
}
</style>

<head>
    <meta charset="utf-8" />
    <title>Idle Mining</title>
    <p id="title">Idle Mining</p>
    <p id="sub">A Clicking Game</p>
</head>
<body>
    <table>
        <tr><th>
    Dirt: <span id="dirt">0</span>
    <br>
    <button class="button" onclick="mouseMine(1)">
        Mine Dirt
    </button>
        </th>

        <th>
    <button title="Each level adds 1 dirt per click/auto" onclick="upgMine()">
        Upgrade Dirt Clicks
    </button>
    <br>
    Level: <span id="minelvl">1</span>/5
    <br>
    Cost: <span id="clickcost">20 Dirt</span>
        </th>

        <th>
    <button title="Consumes 0.5 energy/second to produce dirt" onclick="buyMiner(1)">
        Buy 1 Miner
    </button>
    <br>
    Miners: <span id="miners">0</span>/50
    <br>
    Cost: <span id="minecost">10 Dirt</span>
        </th></tr>

        <td>
    Energy: <span id="energy">0</span>/100
    <br>
    <button class="button" id="btenergy" onclick="makeEnergy(1)">
        Produce Energy
    </button>
        </td>

        <td>
    <button title="Each level adds 1 energy per click/auto" onclick="upgEnergy()">
        Upgrade Energy Clicks
    </button>
    <br>
    Level: <span id="energylvl">1</span>/5
    <br>
    Cost: <span id="energycost">20 Energy</span>
        </td>

        <td>
    <button title="Produces 0.5 energy/second" onclick="buyPanel(1)">
        Buy 1 Solar Panel
    </button>
    <br>
    Solar Panels: <span id="panels">0</span>/10
    <br>
    Cost: <span id="pancost">20 Energy</span>
        </td>

    </table>
    <br>

    <p><buttton class="special" title="Each prestige increases overall production by a factor of 1.25" onclick="prestige()">
        Prestige
    </buttton>
    <br>
    Prestige Cost: <span id="prestigecost">1000 Dirt</span>
    <br>
    Current Prestige: <span id="prestigelvl">1</span>
    <br>
    Presige Bonus: <span id="prestigebonus">100%</span>

    <br><br>
    <button onclick="save()">
        Save Game
    </button>

    <button onclick="load()">
        Load Game
    </button></p>
    <br><br>
    <p id="sub">To find out more about a certain item, hover over its button</p>
</body>
</html>

<script>
//our variables
var dirt = 0;
var miners = 0;
var minelvl = 1;
var minemax = 50;
var energy = 0;
var energymax = 100;
var panels = 0;
var panmax = 10;
var energylvl = 1;
var clickmax = 5;
var prestigelvl = 1;

//allows clicking to make dirt
function mouseMine(number) {
    number = number * prestigelvl * 1.25
	dirt = dirt + (number*minelvl);
  document.getElementById("dirt").innerHTML = round(dirt);
};

//allows clicking to make energy
function makeEnergy(number) {
    number = number * prestigelvl * 1.25
    if ((energy+(number*energylvl)) < energymax) {
    energy = energy + (number*energylvl);
    document.getElementById("energy").innerHTML = round(energy);
    } else {
    energy = energymax;
    document.getElementById("energy").innerHTML = round(energy);
    };
};

//makes miners drain energy
function drainEnergy() {
    if (energy >= miners/2) {
    energy = energy - (miners / 2);
    mouseMine(miners);
    document.getElementById("energy").innerHTML = round(energy);
    };
};

//purchases miners and increases costs
function buyMiner() {
	var minecost = Math.floor(10 + Math.pow(miners,2));
    if(dirt >= minecost && miners < minemax) {
        miners = miners + 1;
        dirt = dirt - minecost;
        document.getElementById("miners").innerHTML = round(miners);
        document.getElementById("dirt").innerHTML = round(dirt);
        var nextcost = Math.floor(10 + Math.pow(miners,2));
        document.getElementById("minecost").innerHTML = nextcost + " Dirt";
        if (miners == minemax) {
            document.getElementById("minecost").innerHTML = "Maxed";
        };
    };
};

//upgrades clicks that make dirt
function upgMine() {
	var clickcost = Math.floor(20 + Math.pow(minelvl,2));
    if(dirt >= clickcost && minelvl < clickmax) {
        minelvl = minelvl + 1;
        dirt = dirt - clickcost;
        document.getElementById("minelvl").innerHTML = round(minelvl);
        document.getElementById("dirt").innerHTML = round(dirt);
        var nextcost = Math.floor(20 + Math.pow(minelvl,2));
        document.getElementById("clickcost").innerHTML = nextcost + " Dirt";
        if (minelvl == clickmax) {
            document.getElementById("clickcost").innerHTML = "Maxed";
        };
    };
};

//upgrades clicks that make energy
function upgEnergy() {
	var energycost = Math.floor(20 + Math.pow(energylvl,2));
    if(energy >= energycost && energylvl < 5) {
        energylvl = energylvl + 1;
        energy = energy - energycost;
        document.getElementById("energylvl").innerHTML = round(energylvl);
        document.getElementById("energy").innerHTML = round(energy);
        var nextcost = Math.floor(20 + Math.pow(energylvl,2));
        document.getElementById("energycost").innerHTML = nextcost + " Energy";
        if (energylvl == clickmax) {
            document.getElementById("energycost").innerHTML = "Maxed";
        };
    };
};

//buys solar panels
function buyPanel() {
    var pancost = Math.floor(20 + Math.pow(panels,2));
    pancost = costcheck(pancost,energymax);
    if(energy >= pancost && panels < panmax) {
        panels = panels + 1;
        energy = energy - pancost;
        document.getElementById("panels").innerHTML = round(panels);
        document.getElementById("energy").innerHTML = round(energy);
        var nextcost = Math.floor(20 + Math.pow(panels,2));
        if (costcheck(nextcost,energymax) == energymax) {
            document.getElementById("pancost").innerHTML = energymax + " Energy";
        } else {
            document.getElementById("pancost").innerHTML = nextcost + " Energy";
        };
        if (panels == panmax) {
            document.getElementById("pancost").innerHTML = "Maxed";
        };
    };
};

//allows prestiging for a bonus
function prestige() {
    var prestigecost = Math.floor(1000*prestigelvl);
    if (dirt >= prestigecost) {
        dirt = 0;
        miners = 0;
        minecost = "10 Dirt";
        minelvl = 1;
        clickcost = "20 Dirt";
        energy = 0;
        energylvl = 1;
        energycost = "20 Energy";
        panels = 0;
        pancost = "20 Energy";
        prestigelvl = prestigelvl + 1;
        update();
    };
};

//updates values
function update() {
    document.getElementById("dirt").innerHTML = round(dirt);
    document.getElementById("miners").innerHTML = round(miners);
    document.getElementById("minecost").innerHTML = minecost;
    document.getElementById("minelvl").innerHTML = round(minelvl);
    document.getElementById("clickcost").innerHTML = clickcost;
    document.getElementById("energy").innerHTML = round(energy);
    document.getElementById("energylvl").innerHTML = round(energylvl);
    document.getElementById("energycost").innerHTML = energycost;
    document.getElementById("panels").innerHTML = round(panels);
    document.getElementById("pancost").innerHTML = pancost;
    document.getElementById("prestigelvl").innerHTML = prestigelvl;
    document.getElementById("prestigecost").innerHTML = prestigelvl*1000 + " Dirt";
    document.getElementById("prestigebonus").innerHTML = prestigelvl*1.25*100 + "%";
};

//rounds numbers
function round(input) {
    input = input * 10;
    var output = Math.round(input * 1000000)/1000000;
    output = output / 10;
        return output;
};

//check max cost of product
function costcheck(cost,cap) {
    if (cost > cap) {
        cost = cap;
        return cost;
    } else {
        return cost;
    };
};

//stores variables for saving
function save() {
    localStorage.setItem("dirt",JSON.stringify(dirt));
    localStorage.setItem("miners",JSON.stringify(miners));
    localStorage.setItem("minecost",JSON.stringify(minecost));
    localStorage.setItem("minelvl",JSON.stringify(minelvl));
    localStorage.setItem("clickcost",JSON.stringify(clickcost));
    localStorage.setItem("energy",JSON.stringify(energy));
    localStorage.setItem("energylvl",JSON.stringify(energylvl));
    localStorage.setItem("energycost",JSON.stringify(energycost));
    localStorage.setItem("panels",JSON.stringify(panels));
    localStorage.setItem("pancost",JSON.stringify(pancost));
    localStorage.setItem("prestigelvl",JSON.stringify(prestigelvl));
};

//loads game
function load() {
    dirt = JSON.parse(localStorage.getItem("dirt"));
    miners = JSON.parse(localStorage.getItem("miners"));
    minecost = JSON.parse(localStorage.getItem("minecost"));
    minelvl = JSON.parse(localStorage.getItem("minelvl"));
    clickcost = JSON.parse(localStorage.getItem("clickcost"));
    energy = JSON.parse(localStorage.getItem("energy"));
    energylvl = JSON.parse(localStorage.getItem("energylvl"));
    energycost = JSON.parse(localStorage.getItem("energycost"));
    panels = JSON.parse(localStorage.getItem("panels"));
    pancost = JSON.parse(localStorage.getItem("pancost"));
    prestigelvl = JSON.parse(localStorage.getItem("prestigelvl"));
};

//auto functions (miners drain energy, panels make energy, prestige production)
window.setInterval(function() {
    drainEnergy();
    makeEnergy(panels/2);
}, 1000);

//how often to autosave
window.setInterval(function() {
	save();
}, 60000);
</script>